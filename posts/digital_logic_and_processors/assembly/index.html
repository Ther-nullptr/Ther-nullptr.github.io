<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>MIPS汇编语言 :: Ther&#39;s Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="处理器 处理器架构  普林斯顿架构：存储器同时存储指令和其他数据 哈佛架构：数据存储和指令存储分开  处理器性能 执行时间 = 指令数 x CPI x 时钟周期
或： $$ CPI = CPI_1\times p_1&#43;&amp;hellip;&#43;CPI_n\times p_n $$ 性能提升方法：
 优化编译技术（减少指令数） 快速电路技术或更为先进的电路结构（减少时钟周期）  寄存器 VS 存储器  寄存器：以编号进行访问，可同时访问不同寄存器。 存储器：以地址进行访问，不可同时访问不同地址，相邻数据的地址相差4字节。  数据单位约定 在32位MIPS中，1 word = 4 bytes = 32 bits，相邻数据的地址相差4字节。
1 2 3 4 5 6 7 8 9 10 11  #include&amp;lt;stdio.h&amp;gt;int main() { printf(&amp;#34;%d\n&amp;#34;,sizeof(int)); // 4  printf(&amp;#34;%d\n&amp;#34;,sizeof(char)); // 1  printf(&amp;#34;%d\n&amp;#34;,sizeof(unsigned int)); // 4  printf(&amp;#34;%d\n&amp;#34;,sizeof(long int)); // 8  printf(&amp;#34;%d\n&amp;#34;,sizeof(long long int)); // 8  printf(&amp;#34;%d\n&amp;#34;,sizeof(float)); // 4  printf(&amp;#34;%d\n&amp;#34;,sizeof(double)); // 8 }   MIPS汇编指令 汇编优化相关问题   算数&amp;amp;逻辑指令11bit冗余能否利用起来？" />
<meta name="keywords" content="study" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://ther-nullptr.github.io/posts/digital_logic_and_processors/assembly/" />




<link rel="stylesheet" href="https://ther-nullptr.github.io/assets/style.css">

  <link rel="stylesheet" href="assets/%25!s%28%3cnil%3e%29.css">






<link rel="apple-touch-icon" href="https://ther-nullptr.github.io/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://ther-nullptr.github.io/">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="MIPS汇编语言">
<meta property="og:description" content="处理器 处理器架构  普林斯顿架构：存储器同时存储指令和其他数据 哈佛架构：数据存储和指令存储分开  处理器性能 执行时间 = 指令数 x CPI x 时钟周期
或： $$ CPI = CPI_1\times p_1&#43;&amp;hellip;&#43;CPI_n\times p_n $$ 性能提升方法：
 优化编译技术（减少指令数） 快速电路技术或更为先进的电路结构（减少时钟周期）  寄存器 VS 存储器  寄存器：以编号进行访问，可同时访问不同寄存器。 存储器：以地址进行访问，不可同时访问不同地址，相邻数据的地址相差4字节。  数据单位约定 在32位MIPS中，1 word = 4 bytes = 32 bits，相邻数据的地址相差4字节。
1 2 3 4 5 6 7 8 9 10 11  #include&amp;lt;stdio.h&amp;gt;int main() { printf(&amp;#34;%d\n&amp;#34;,sizeof(int)); // 4  printf(&amp;#34;%d\n&amp;#34;,sizeof(char)); // 1  printf(&amp;#34;%d\n&amp;#34;,sizeof(unsigned int)); // 4  printf(&amp;#34;%d\n&amp;#34;,sizeof(long int)); // 8  printf(&amp;#34;%d\n&amp;#34;,sizeof(long long int)); // 8  printf(&amp;#34;%d\n&amp;#34;,sizeof(float)); // 4  printf(&amp;#34;%d\n&amp;#34;,sizeof(double)); // 8 }   MIPS汇编指令 汇编优化相关问题   算数&amp;amp;逻辑指令11bit冗余能否利用起来？" />
<meta property="og:url" content="https://ther-nullptr.github.io/posts/digital_logic_and_processors/assembly/" />
<meta property="og:site_name" content="Ther&#39;s Blog" />

  
    <meta property="og:image" content="https://ther-nullptr.github.io/">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

  <meta property="article:section" content="study" />


  <meta property="article:published_time" content="2022-06-03 00:00:00 &#43;0000 UTC" />












</head>
<body class="">


<div class="container headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://ther-nullptr.github.io/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/posts/">Home</a></li>
        
      
        
          <li><a href="/about/">About</a></li>
        
      
        
          <li><a href="/archives/">Archives</a></li>
        
      
        
          <li><a href="/search/">Search</a></li>
        
      
        
          <li><a href="/links/">Links</a></li>
        
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/posts/">Home</a></li>
      
    
      
        <li><a href="/about/">About</a></li>
      
    
      
        <li><a href="/archives/">Archives</a></li>
      
    
      
        <li><a href="/search/">Search</a></li>
      
    
      
        <li><a href="/links/">Links</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://ther-nullptr.github.io/posts/digital_logic_and_processors/assembly/">MIPS汇编语言</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-06-03
        
      </span>
    
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://ther-nullptr.github.io/tags/digital-logic-and-processors/">digital logic and processors</a>&nbsp;
    
  </span>
  
  


  

  <div class="post-content"><div>
        <h1 id="处理器">处理器<a href="#处理器" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="处理器架构">处理器架构<a href="#处理器架构" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>普林斯顿架构：存储器同时存储指令和其他数据</li>
<li>哈佛架构：数据存储和指令存储分开</li>
</ul>
<h2 id="处理器性能">处理器性能<a href="#处理器性能" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>执行时间 = 指令数 x CPI x 时钟周期</p>
<p>或：
$$
CPI = CPI_1\times p_1+&hellip;+CPI_n\times p_n
$$
性能提升方法：</p>
<ul>
<li>优化编译技术（减少指令数）</li>
<li>快速电路技术或更为先进的电路结构（减少时钟周期）</li>
</ul>
<h2 id="寄存器-vs-存储器">寄存器 VS 存储器<a href="#寄存器-vs-存储器" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>寄存器：以编号进行访问，可同时访问不同寄存器。</li>
<li>存储器：以地址进行访问，不可同时访问不同地址，相邻数据的地址相差4字节。</li>
</ul>
<h2 id="数据单位约定">数据单位约定<a href="#数据单位约定" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>在32位MIPS中，1 word = 4 bytes = 32 bits，相邻数据的地址相差4字节。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span> <span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">));</span> <span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span> <span class="kt">int</span><span class="p">));</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">));</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span> <span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="mips汇编指令">MIPS汇编指令<a href="#mips汇编指令" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="汇编优化相关问题">汇编优化相关问题<a href="#汇编优化相关问题" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ol>
<li>
<p>算数&amp;逻辑指令11bit冗余能否利用起来？</p>
<p>额外11bit用于移位量&amp;功能码。好处：寄存器算术操作只占用一种操作码，指令集可以使用其他操作码支持更多种指令。</p>
</li>
<li>
<p>分支可能的地址范围有32位，如何用16bit表示？</p>
<p>采用基址+偏移地址的寻址方式。</p>
<blockquote>
<p>addr &laquo; 2：将直接地址转换为字节地址。</p>
</blockquote>
</li>
<li>
<p>带立即数的分支指令立即数如何编码？</p>
<p>MIPS没有带立即数的分支指令，使用比较指令(slti、sltiu等）+ 分支指令组合实现。</p>
</li>
<li>
<p>访存可能的地址有32位，如何用21bit表示？</p>
<p>采用基址+偏移地址的寻址方式进行访存（5 bit：寄存器 16 bit：立即数）。</p>
</li>
<li>
<p>跳转可能的地址有32位，如何用26bit表示？</p>
<p><code>j</code>小范围，<code>jr</code>大范围。</p>
</li>
</ol>
<h2 id="寻址方式">寻址方式<a href="#寻址方式" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ol>
<li>寄存器寻址：找到对应的寄存器，从寄存器中取数/写数。如：R type(add)。</li>
<li>立即数寻址：指令中的立即数可以被直接使用。如：I type(addi)</li>
<li>基址寻址：目标地址=基址（存储于寄存器中）+ 立即数。如：lw,sw</li>
<li>PC相对寻址：PC+立即数。如：beq</li>
<li>伪直接寻址：固定PC的高4位不变。如：j</li>
</ol>
<h2 id="mips过程调用">MIPS过程调用<a href="#mips过程调用" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>
<p>Preserved（子程序不改变这些寄存器的数据，如果子程序要用，需要子程序维护好）</p>
</li>
<li>
<p>Not Preserved（子程序可以改变这些寄存器的数据，如果主程序要用，需要主程序维护好）</p>
<p><img src="C:%5CUsers%5C86181%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220603160128725.png" alt="image-20220603160128725"></p>
</li>
</ul>
<p>考虑以下汇编：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">fact:</span>
</span></span><span class="line"><span class="cl"><span class="nf">addi</span> <span class="no">$sp</span><span class="p">,</span> <span class="no">$sp</span><span class="p">,</span> <span class="p">-</span><span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="nf">sw</span> <span class="no">$ra</span><span class="p">,</span> <span class="mi">4</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">sw</span> <span class="no">$a0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">slti</span> <span class="no">$t0</span><span class="p">,</span> <span class="no">$a0</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nf">beq</span> <span class="no">$t0</span><span class="p">,</span> <span class="no">$zero</span><span class="p">,</span> <span class="no">L1</span>
</span></span><span class="line"><span class="cl"><span class="nf">addi</span> <span class="no">$v0</span><span class="p">,</span> <span class="no">$zero</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nf">addi</span> <span class="no">$sp</span><span class="p">,</span> <span class="no">$sp</span><span class="p">,</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="nf">jr</span> <span class="no">$ra</span>
</span></span><span class="line"><span class="cl"><span class="nl">L1:</span>
</span></span><span class="line"><span class="cl"><span class="nf">addi</span> <span class="no">$a0</span><span class="p">,</span> <span class="no">$a0</span><span class="p">,</span> <span class="p">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nf">jal</span> <span class="no">fact</span>
</span></span><span class="line"><span class="cl"><span class="nf">lw</span> <span class="no">$a0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">lw</span> <span class="no">$ra</span><span class="p">,</span> <span class="mi">4</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">addi</span> <span class="no">$sp</span><span class="p">,</span> <span class="no">$sp</span><span class="p">,</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="nf">mul</span> <span class="no">$v0</span><span class="p">,</span> <span class="no">$a0</span><span class="p">,</span> <span class="no">$v0</span>
</span></span><span class="line"><span class="cl"><span class="nf">jr</span> <span class="no">$ra</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>对应：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">fact</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
      </div></div>

  

  
  

  
</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2022 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://ther-nullptr.github.io/assets/main.js"></script>
<script src="https://ther-nullptr.github.io/assets/prism.js"></script>







  
</div>

</body>
</html>
